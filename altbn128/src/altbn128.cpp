#include <altbn128.hpp>

extern "C" {

__attribute__((eosio_wasm_import)) 
int32_t alt_bn128_add( const char* op1_data, uint32_t op1_length,
                    const char* op2_data, uint32_t op2_length, 
                    char* result , uint32_t result_length);

__attribute__((eosio_wasm_import)) 
int32_t alt_bn128_mul( const char* op1_data, uint32_t op1_length,
                    const char* op2_data, uint32_t op2_length, 
                    char* result , uint32_t result_length);

__attribute__((eosio_wasm_import)) 
int32_t alt_bn128_pair( const char* op1_data, uint32_t op1_length,
                    char* result , uint32_t result_length);

__attribute__((eosio_wasm_import)) 
int32_t mod_exp( uint32_t base_len,
                 uint32_t exp_len,
                 uint32_t mod_len, 
                 const char* base_data, uint32_t base_length,
                 const char* exp_data, uint32_t exp_length,
                 const char* mod_data, uint32_t mod_length,
                 char* result, uint32_t result_length);

}

ACTION altbn128::hi( name nm ) {
   /* fill in action body */
   print_f("Name : %\n",nm);

   // TEST SUM

   unsigned char op1[64] = { 34,36,128,201,249,84,9,191,164,172,106,232,144,185,193,80,188,136,84,43,135,179,82,233,41,80,195,64,69,139,12,9,
                    41,118,239,214,152,207,35,180,20,234,98,43,63,114,13,217,8,13,103,144,66,72,47,243,102,140,178,227,44,173,138,226};
   unsigned char op2[64] = { 27,210,11,236,163,216,210,142,83,109,43,91,211,191,54,215,106,246,138,245,230,201,108,166,229,81,155,169,255,143,83,50,
                    42,83,237,246,180,139,207,92,177,192,180,173,29,54,223,206,6,167,157,205,101,38,241,195,134,161,77,140,228,100,152,68};
   unsigned char ret[64] = { 0 };


   print_f("OP1:"); eosio::printhex(op1, 64); print_f("\n");
   print_f("OP2:"); eosio::printhex(op2, 64); print_f("\n");
   
   alt_bn128_add( (char*)op1, 64, (char*)op2, 64, (char*)ret, 64);

   print_f("OUT:"); eosio::printhex(ret, 64); print_f("\n");


   // TEST MUL

   unsigned char oo1[64] = { 30,70,45,1,209,134,31,126,228,153,191,112,171,18,173,227,53,217,133,134,181,45,184,71,238,46,193,231,144,23,14,4,
                     20,189,128,127,78,100,144,75,41,232,116,253,130,79,241,110,70,91,87,152,177,154,175,224,202,230,10,45,188,249,19,51 };
   unsigned char oo2[32] = { 48,88,111,133,232,252,234,145,192,219,30,211,10,172,247,53,14,114,239,212,207,117,107,60,227,9,242,21,158,39,95,249 };
   unsigned char rot[64] = { 0 };


   print_f("OP1:"); eosio::printhex(oo1, 64); print_f("\n");
   print_f("OP2:"); eosio::printhex(oo2, 32); print_f("\n");
   
   alt_bn128_mul( (char*)oo1, 64, (char*)oo2, 32, (char*)rot, 64);

   print_f("OUT:"); eosio::printhex(rot, 64); print_f("\n");

   unsigned char g1g2pairs[384] = { 43,207,21,75,1,13,237,180,80,207,234,79,99,85,38,151,63,57,54,94,194,4,228,168,176,227,236,194,154,187,126,78,35,219,132,183,174,78,53,104,30,131,59,106,31,105,3,226,130,145,209,84,175,62,197,221,199,135,224,230,203,5,137,18,39,210,82,86,22,205,136,58,46,149,38,22,19,142,5,33,37,32,24,38,212,94,23,154,154,226,134,85,51,140,162,190,33,103,255,85,211,106,46,217,46,180,128,177,185,54,83,130,234,47,172,234,144,200,96,214,50,17,130,127,18,47,220,41,44,110,139,93,93,169,160,63,45,107,87,191,35,56,22,142,202,30,67,64,150,147,180,54,89,254,131,65,73,229,6,169,2,4,1,215,142,111,231,70,254,61,149,18,249,180,238,220,253,215,235,93,8,227,7,241,214,238,93,56,249,162,83,236,43,207,21,75,1,13,237,180,80,207,234,79,99,85,38,151,63,57,54,94,194,4,228,168,176,227,236,194,154,187,126,78,12,136,201,187,50,227,106,193,153,205,10,76,98,24,84,123,20,239,153,60,185,51,4,175,116,152,171,48,13,119,116,53,39,210,82,86,22,205,136,58,46,149,38,22,19,142,5,33,37,32,24,38,212,94,23,154,154,226,134,85,51,140,162,190,33,103,255,85,211,106,46,217,46,180,128,177,185,54,83,130,234,47,172,234,144,200,96,214,50,17,130,127,18,47,220,41,44,110,139,93,93,169,160,63,45,107,87,191,35,56,22,142,202,30,67,64,150,147,180,54,89,254,131,65,73,229,6,169,2,4,1,215,142,111,231,70,254,61,149,18,249,180,238,220,253,215,235,93,8,227,7,241,214,238,93,56,249,162,83,236 };
   unsigned char rut[64] = { 0 };

   alt_bn128_pair( (char*)g1g2pairs, 384, (char*)rut, 64);
   print_f("OUT:"); eosio::printhex(rut, 64); print_f("\n");


   uint32_t l1 = 1;
   uint32_t l2 = 2;
   uint32_t l3 = 32;
   unsigned char tt1[1] = { 3 };
   unsigned char tt2[2] = { 255, 255 };
   unsigned char tt3[32] = { 0x80, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 };
   unsigned char mer[64] = { 0 };
   mod_exp( l1, l2, l3, (char*)tt1, l1, (char*)tt2, l2, (char*)tt3, l3, (char*)mer, 64 );
   print_f("OUT:"); eosio::printhex(mer, 64); print_f("\n");
}
